<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.ac.kopo.dao.RestaurantImageDAO">

    <!-- 리뷰별 이미지 조회 -->
    <select id="selectImagesByReviewId" parameterType="int" resultType="kr.ac.kopo.vo.RestaurantImageVO">
        SELECT 
            IMAGE_ID       AS imageId,
            RESTAURANT_ID  AS restaurantId,
            REVIEW_ID      AS reviewId,
            MEMBER_ID      AS memberId,
            IMAGE_URL      AS imageUrl,
            IMG_TYPE       AS imgType,
            REGDATE        AS regdate
        FROM RESTAURANT_IMAGE
        WHERE REVIEW_ID = #{reviewId}
        ORDER BY IMAGE_ID
    </select>    

	<!-- 이미지 등록(INSERT) - 리뷰용/기본 이미지 공용 -->
	<insert id="insertImage" parameterType="kr.ac.kopo.vo.RestaurantImageVO">
	    INSERT INTO RESTAURANT_IMAGE (
	        RESTAURANT_ID, 
	        <if test="reviewId != null">REVIEW_ID,</if>
	        <if test="memberId != null and memberId != ''">MEMBER_ID,</if>
	        IMAGE_URL, 
	        IMG_TYPE, 
	        REGDATE
	    ) VALUES (
	        #{restaurantId}, 
	        <if test="reviewId != null">#{reviewId},</if>
	        <if test="memberId != null and memberId != ''">#{memberId},</if>
	        #{imageUrl}, 
	        #{imgType}, 
	        SYSDATE
	    )
	</insert>
	
	<!-- 리뷰 ID로 이미지 삭제 -->
	<delete id="deleteImagesByReviewId" parameterType="int">
	    DELETE FROM RESTAURANT_IMAGE
	    WHERE REVIEW_ID = #{reviewId}
	</delete>
	
	<!-- 맛집 ID로 '기본' 이미지 목록 조회 -->
    <select id="selectBasicImagesByRestaurantId" parameterType="int" resultType="kr.ac.kopo.vo.RestaurantImageVO">
        SELECT
            IMAGE_ID       AS imageId,
            RESTAURANT_ID  AS restaurantId,
            REVIEW_ID      AS reviewId,
            MEMBER_ID      AS memberId,
            IMAGE_URL      AS imageUrl,
            IMG_TYPE       AS imgType,
            REGDATE        AS regdate
        FROM RESTAURANT_IMAGE
        WHERE RESTAURANT_ID = #{restaurantId}
          AND IMG_TYPE = 'BASIC'
        ORDER BY IMAGE_ID
    </select>
    
    <!-- 이미지 ID로 단일 이미지 삭제 -->
    <delete id="deleteImage" parameterType="int">
        DELETE FROM RESTAURANT_IMAGE
        WHERE IMAGE_ID = #{imageId}
    </delete>
	
</mapper>
